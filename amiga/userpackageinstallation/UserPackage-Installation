; User Package Installation
; -------------------------
; Author: Henrik Noerfjand Stengaard
; Date: 2019-01-02
;
; AmigaDOS script to list user packages and build install user packages to select and install user packages.

; add assigns and set environment variables for user package installation
set userpackagesdir "`CD`"
Assign USERPACKAGESDIR: "$userpackagesdir"
Assign INSTALLDIR: "$userpackagesdir"
Assign C: "INSTALLDIR:C" ADD
Assign SYSTEMDIR: SYS:
SetEnv TZ MST7

; copy reqtools prefs to env, if it doesn't exist
IF NOT EXISTS "ENV:ReqTools.prefs"
  copy >NIL: "INSTALLDIR:Env/ReqTools.prefs" "ENV:"
ENDIF

; run detect user packages
Execute INSTALLDIR:S/Detect-User-Packages T:User-Packages

; Check if user packages contains any user packages
set userpackagescount `wc -l <T:User-Packages`
IF $userpackagescount GT 0 VAL
  ; run build install user packages
  echo ""
  Execute INSTALLDIR:S/Build-Install-User-Packages T:User-Packages T:Install-User-Packages
  Delete >NIL: T:User-Packages

  ; run install user packages
  Execute T:Install-User-Packages
  Delete >NIL: T:Install-User-Packages
ELSE
  echo ""
  echo "*e[1mNo user packages found!*e[22m"
ENDIF

; remove assigns for user package installation
Assign USERPACKAGESDIR: "$userpackagesdir" REMOVE
Assign C: "INSTALLDIR:C" REMOVE
Assign INSTALLDIR: "$userpackagesdir" REMOVE
Assign SYSTEMDIR: SYS: REMOVE
